<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  
  <title>
    
      TinyCI updates - versions 0.2.0 and 0.3.0 - Clever Name
    
  </title>
  <meta name="description" content="There have been two new versions of TinyCI released since launch. 0.2.0 added hooks/callbacks, and 0.3.0 added a handy compact script to compress old build directories. In this post I’ll provide some details on the new functionality.">
  

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://cleverna.me/2018/10/19/tinyci-updates/">
  
  
  <link rel="alternate" type="application/rss+xml" title="Clever Name" href="https://cleverna.me/feed.xml">

  

  
  <meta name="twitter:card" content="summary">
  
  <meta name="twitter:title" content="">
  <meta name="twitter:description" content="There have been two new versions of TinyCI released since launch. 0.2.0 added hooks/callbacks, and 0.3.0 added a handy compact script to compress old build directories. In this post I’ll provide so...">
  
  

  <link rel="dns-prefetch" href="https://fonts.gstatic.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bitter:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">

  

</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">Clever Name</a>

    <nav class="site-nav">
      
        
        <a class="page-link" href="/archives">Archives</a>
      
        
        <a class="page-link" href="/code">Code</a>
      
        
        <a class="page-link" href="http://unmode.com">Music</a>
      
        
        <a class="page-link" href="mailto:jonnie@cleverna.me">Contact</a>
      
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    
      <h1 class="post-title" itemprop="name headline">TinyCI updates - versions 0.2.0 and 0.3.0</h1>
    
    <p class="post-meta"><time datetime="2018-10-19T10:35:00+01:00" itemprop="datePublished">Oct 19, 2018</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>There have been two new versions of TinyCI released since launch. 0.2.0 added hooks/callbacks, and 0.3.0 added a handy <code class="language-plaintext highlighter-rouge">compact</code> script to compress old build directories.</p>

<p>In this post I’ll provide some details on the new functionality.</p>

<!-- more -->

<h3 id="020---hooks">0.2.0 - hooks</h3>

<p>This release adds hooks to TinyCI. These are just scripts that are called at various points in the execution sequence.</p>

<p>Let us quote the order of execution from <a href="https://github.com/JonnieCache/tinyci#hooks">the README:</a></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  * clean
  * export

  before_build
  
  * build
  
  after_build_success
  after_build_failure
  after_build
  
  before_test
  
  * test
  
  after_test_success
  after_test_failure
  after_test
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">*</code> indicates an actual phase of TinyCI’s execution, the rest are hooks. We have <code class="language-plaintext highlighter-rouge">before_x</code>, <code class="language-plaintext highlighter-rouge">after_x_success</code>, <code class="language-plaintext highlighter-rouge">after_x_failure</code> and <code class="language-plaintext highlighter-rouge">after_x</code> for both the build and test phases.</p>

<p>As you might imagine, the <code class="language-plaintext highlighter-rouge">before</code> and <code class="language-plaintext highlighter-rouge">after</code> hooks always fire, and the <code class="language-plaintext highlighter-rouge">success</code> and <code class="language-plaintext highlighter-rouge">failure</code> hooks are called only under the relevant condition.</p>

<p>Additionally, the <code class="language-plaintext highlighter-rouge">before</code> hooks will halt processing of the commit if they fail (return an exit status &gt; 0.) The other hooks will not stop execution.</p>

<p>Hooks are enabled by adding a section to <code class="language-plaintext highlighter-rouge">.tinyci.yml</code> like so:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hooker:
  class: ScriptHooker
  config:
    before_test: ./before_test.sh
</code></pre></div></div>

<p>These hooks could be used for a variety of purposes, from simple ones like sending email or slack notifications on successful/failed testing of builds, to more complex uses like automated continuous deployment.</p>

<p>Some of these possibilities are explored in the newly updated <a href="https://github.com/JonnieCache/tinyci-example">tinyci-example</a> project.</p>

<h3 id="030---the-compact-command">0.3.0 - the <code class="language-plaintext highlighter-rouge">compact</code> command</h3>

<p>Version 0.3.0 added the <code class="language-plaintext highlighter-rouge">tinyci compact</code> command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tinyci compact --help
Usage: compact [options]
    -n, --num-builds-to-leave &lt;NUM&gt;  number of builds to leave in place, starting from the most recent
    -b, --builds-to-leave &lt;BUILDS&gt;   specific build directories to leave in place, comma-separated
    -q, --[no-]quiet                 quietly run
</code></pre></div></div>

<p>The compactor is a script that compresses old build directories into <code class="language-plaintext highlighter-rouge">.tar.gz</code> files. “Old” is defined according to the options as described in the help there. For a full discussion, see the aforementioned <a href="(https://github.com/JonnieCache/tinyci-example)">example project.</a></p>

<h3 id="issueslimitations">Issues/Limitations</h3>

<p>Both of these features are in their infancy, and there are improvements to be made:</p>

<ul>
  <li>
    <p>A fuller set of hooks could be added, although the ones currently provided should be enough to cover the majority of use cases.</p>
  </li>
  <li>
    <p>Information about the execution should be passed to the hooks via environment variables. This is sort of an essential feature, especially for notification hooks, but some data can be obtained currently by parsing the log file.</p>
  </li>
  <li>
    <p>The compactor should have more ways to specify which directories to compress, for example some kind of date filtering, or filtering based on build/test success.</p>
  </li>
  <li>
    <p>The compactor should have the ability to delete builds without keeping a compressed copy.</p>
  </li>
</ul>

<p>Watch this space!</p>

  </div>

  

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <p>
      

&copy;  - Powered by <a href="https://jekyllrb.com">Jekyll</a> &amp; <a href="https://github.com/yous/whiteglass">whiteglass</a> - Subscribe via <a href="https://cleverna.me/feed.xml">RSS</a>

    </p>

  </div>

</footer>


  </body>

</html>
